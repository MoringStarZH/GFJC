import{k as te,s as V}from"./index-BPolhdD0.js";import{b as ae,a as w,r as v,o as le,c as U,q as e,m as a,F as T,h as ne,n as r,i as f,g as c,x as re,e as z,k as ie,l as b,t as oe,y as L,u as h,_ as se}from"./index-BUNzSB4e.js";const ce={class:"center-box"},de={class:"center-box"},pe=ae({__name:"Management",setup(ue){const{proxy:o}=ie();let u=w({page:1,pageSize:5});const R=v(1);let d="待专家审核";const y=w([]),j=w(["待审核","待接单","待维修","已维修","工单销项","返工工单"]),$=v(""),B=ne(),_=v(!1),x=v(""),s=w({}),N=v("https://fuss10.elemecdn.com/e/5d/4a731a90594a4af544c0c25941171jpeg.jpeg"),q=t=>{u.pageSize=t,g()},M=t=>{u.page=t,g()};function D(t,i){return i.riskLevel===t}function E(t,i){return i.defectType===t}function F(t){return t.riskLevel==="一级风险"?"info":t.riskLevel==="二级风险"?"warning":"danger"}const g=async()=>{o.$startLoading();const t=await te({...u,status:d});if(o.$closeLoading(),t.code!==1)return o.$message.error("获取列表失败");y.splice(0,y.length,...t.data.records),R.value=t.data.total},W=t=>{console.log(t),B.push({path:"/defect/management/review",query:{id:t.picId}})},I=t=>{_.value=!0,x.value=N.value,Object.assign(s,t)},A=async()=>{o.$startLoading();const t=await V("专家复审通过，可销项",{id:s.id,expertId:s.expertId,ifReview:s.ifReview,ifRepair:s.ifRepair});if(o.$closeLoading(),t.code!==1)return o.$message.error("提交失败");o.$message.success("复审完成，结果已提交"),g(),_.value=!1},O=async()=>{o.$startLoading();const t=await V("专家复审未通过，返工",{id:s.id,expertId:s.expertId,ifReview:s.ifReview,ifRepair:s.ifRepair});if(o.$closeLoading(),t.code!==1)return o.$message.error("提交失败");o.$message.success("复审完成，结果已提交"),g(),_.value=!1},P=t=>{t==="0"?d="待专家审核":t==="1"?d="待维修人员接单":t==="2"?d="维修人员已接单，待维修":t==="3"?d="维修完成，待专家复审":t==="4"?d="专家复审通过，可销项":d="专家复审未通过，返工",console.log(d),g()};return le(()=>{g()}),(t,i)=>{const k=r("el-breadcrumb-item"),G=r("el-breadcrumb"),n=r("el-table-column"),C=r("el-image"),H=r("el-tag"),m=r("el-button"),J=r("el-table"),K=r("el-pagination"),Q=r("el-tab-pane"),X=r("el-tabs"),Y=r("el-input"),Z=r("el-dialog"),ee=r("el-card");return f(),U(T,null,[e(G,{separator:"/"},{default:a(()=>[e(k,{to:{path:"/home"}},{default:a(()=>[c("首页")]),_:1}),e(k,null,{default:a(()=>[c("缺陷检测管理")]),_:1}),e(k,null,{default:a(()=>[c("缺陷事件处理")]),_:1})]),_:1}),e(ee,null,{default:a(()=>[e(X,{type:"card",class:"demo-tabs",onTabChange:P},{default:a(()=>[(f(!0),U(T,null,re(j,(p,ge)=>(f(),b(Q,{lazy:!0,label:p},{default:a(()=>[e(J,{data:y,stripe:"",border:"",fit:"",style:{width:"100%"}},{default:a(()=>[e(n,{type:"index",fixed:"",sortable:"",label:"序号",align:"center",width:"80"}),e(n,{prop:"id",label:"id",align:"center",width:"200"}),e(n,{prop:"picId",label:"图片编号",align:"center",width:"300"}),e(n,{prop:"inspectId",label:"巡检工编号",align:"center",width:"200"}),e(n,{prop:"description",label:"描述",align:"center",width:"200"}),e(n,{prop:"inspectedInfo",label:"寻监工信息",align:"center",width:"200"}),e(n,{label:"原始图片",width:"100"},{default:a(l=>[e(C,{style:{width:"60px",height:"60px"},src:l.row.originalUrl,"preview-src-list":[l.row.originalUrl]},null,8,["src","preview-src-list"])]),_:1}),e(n,{label:"分析后图片",width:"100"},{default:a(l=>[e(C,{style:{width:"60px",height:"60px"},src:l.row.analyzedUrl,"preview-src-list":[l.row.analyzedUrl]},null,8,["src","preview-src-list"])]),_:1}),e(n,{prop:"defectType",filters:[{text:"裂痕",value:"裂痕"},{text:"物理损坏",value:"物理损坏"},{text:"电气损坏",value:"电气损坏"},{text:"脏污",value:"脏污"},{text:"积雪覆盖",value:"积雪覆盖"},{text:"清洁",value:"清洁"}],label:"缺陷类型",align:"center",width:"150","filter-method":E}),e(n,{prop:"riskLevel",filters:[{text:"一级风险",value:"一级风险"},{text:"二级风险",value:"二级风险"},{text:"三级风险",value:"三级风险"}],label:"风险等级",align:"center",width:"150","filter-method":D},{default:a(l=>[e(H,{type:F(l.row),"disable-transitions":""},{default:a(()=>[c(oe(l.row.riskLevel),1)]),_:2},1032,["type"])]),_:1}),e(n,{prop:"createTime",sortable:"",label:"创建时间",align:"center",width:"200"}),e(n,{prop:"updateTime",sortable:"",label:"更新时间",align:"center",width:"200"}),p==="待审核"?(f(),b(n,{key:0,fixed:"right",label:"操作",width:"120",align:"center"},{default:a(l=>[e(m,{link:"",type:"primary",size:"small",onClick:S=>W(l.row)},{default:a(()=>[c("审查")]),_:2},1032,["onClick"])]),_:1})):L("",!0),p==="已维修"?(f(),b(n,{key:1,fixed:"right",label:"操作",width:"120",align:"center"},{default:a(l=>[e(m,{link:"",type:"primary",size:"small",onClick:S=>I(l.row)},{default:a(()=>[c("销项")]),_:2},1032,["onClick"])]),_:1})):L("",!0),p==="工单销项"?(f(),b(n,{key:2,fixed:"right",label:"操作",width:"120",align:"center"},{default:a(l=>[e(m,{link:"",type:"primary",size:"small",onClick:S=>I(l.row)},{default:a(()=>[c("销项")]),_:2},1032,["onClick"])]),_:1})):L("",!0)]),_:2},1032,["data"]),e(K,{"current-page":h(u).page,"onUpdate:currentPage":i[0]||(i[0]=l=>h(u).page=l),"page-size":h(u).pageSize,"onUpdate:pageSize":i[1]||(i[1]=l=>h(u).pageSize=l),"page-sizes":[5,10,15,20],layout:"total, sizes, prev, pager, next, jumper",total:R.value,onSizeChange:q,onCurrentChange:M},null,8,["current-page","page-size","total"])]),_:2},1032,["label"]))),256))]),_:1}),e(Z,{"align-center":"",title:"维修复审",width:"50%",modelValue:_.value,"onUpdate:modelValue":i[3]||(i[3]=p=>_.value=p)},{default:a(()=>[z("div",ce,[z("div",de,[e(C,{style:{width:"200px",height:"200px"},src:x.value,"preview-src-list":[x.value]},null,8,["src","preview-src-list"])]),e(Y,{style:{width:"70%",margin:"30px 0"},type:"textarea",placeholder:"复审批注",modelValue:$.value,"onUpdate:modelValue":i[2]||(i[2]=p=>$.value=p)},null,8,["modelValue"]),z("div",null,[e(m,{type:"primary",onClick:A},{default:a(()=>[c("复审通过")]),_:1}),e(m,{type:"info",onClick:O},{default:a(()=>[c("不合格")]),_:1})])])]),_:1},8,["modelValue"])]),_:1})],64)}}}),me=se(pe,[["__scopeId","data-v-238adbf5"]]);export{me as default};
